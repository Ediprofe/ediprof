<div id="map-visualizer-overlay" class="visualizer-overlay">
    <!-- Header Overlay (Transparente y Flotante) -->
    <header class="visualizer-header">
        <div class="header-info">
            <span class="badge">Visualización Técnica</span>
            <span id="visualizer-counter" class="counter">1 / 1</span>

            <!-- Botón Lápiz Láser -->
            <button
                id="laser-btn"
                class="tool-btn"
                title="Activar Puntero Láser (L)"
            >
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="20"
                    height="20"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    ><path d="m13.4 2 3.5 3.5-3.5 3.5-3.5-3.5z"></path><path
                        d="M7.4 15.6 2 21"></path><path d="m15.5 15.5 4-4"
                    ></path><path d="M14 17h5"></path><path d="M17 14v5"
                    ></path><path d="m7.4 9.4 6.2 6.2"></path></svg
                >
                <span>Láser</span>
            </button>
        </div>
        <button id="close-visualizer" class="close-btn" title="Cerrar (Esc)">
            <svg
                xmlns="http://www.w3.org/2000/svg"
                width="32"
                height="32"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                ><line x1="18" y1="6" x2="6" y2="18"></line><line
                    x1="6"
                    y1="6"
                    x2="18"
                    y2="18"></line></svg
            >
        </button>
    </header>

    <!-- Área de Imagen "Edge-to-Edge" -->
    <div class="visualizer-main">
        <!-- Lienzo para el Láser Efímero -->
        <canvas id="laser-canvas" class="laser-layer"></canvas>

        <!-- Navegación Lateral -->
        <button
            id="prev-img-side"
            class="side-nav-btn prev"
            aria-label="Anterior"
        >
            <svg
                xmlns="http://www.w3.org/2000/svg"
                width="60"
                height="60"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="1"
                stroke-linecap="round"
                stroke-linejoin="round"><path d="M15 18l-6-6 6-6"></path></svg
            >
        </button>

        <div id="visualizer-image-container" class="image-stage">
            <img id="visualizer-img" src="" alt="Ilustración técnica" />
        </div>

        <button
            id="next-img-side"
            class="side-nav-btn next"
            aria-label="Siguiente"
        >
            <svg
                xmlns="http://www.w3.org/2000/svg"
                width="60"
                height="60"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="1"
                stroke-linecap="round"
                stroke-linejoin="round"
                ><path d="M9 18l6-6-6-6" transform="rotate(180 12 12)"
                ></path></svg
            >
        </button>
    </div>
</div>

<style>
    .visualizer-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: #000000; /* Negro absoluto para proyector */
        display: none;
        flex-direction: column;
        z-index: 999999999;
        color: white;
        font-family: "Space Grotesk", sans-serif;
        overflow: hidden;
    }

    .visualizer-overlay.active {
        display: flex;
    }

    /* Header flotante para no robar espacio */
    .visualizer-header {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 80px;
        padding: 0 3rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: linear-gradient(to bottom, rgba(0, 0, 0, 0.8), transparent);
        z-index: 30; /* Encima de todo */
        opacity: 0.3;
        transition: opacity 0.3s ease;
    }

    .visualizer-header:hover {
        opacity: 1;
    }

    .header-info {
        display: flex;
        align-items: center;
        gap: 2rem;
    }

    /* Botón Láser */
    .tool-btn {
        display: flex;
        align-items: center;
        gap: 8px;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: white;
        padding: 6px 14px;
        border-radius: 8px;
        font-family: inherit;
        font-size: 0.8rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
    }

    .tool-btn:hover {
        background: rgba(255, 255, 255, 0.2);
    }

    .tool-btn.active {
        background: #ef4444;
        border-color: #f87171;
        box-shadow: 0 0 15px rgba(239, 68, 68, 0.4);
    }

    .badge {
        font-size: 0.75rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.15em;
        background: #2563eb;
        padding: 6px 12px;
        border-radius: 4px;
    }

    .counter {
        font-size: 1.1rem;
        font-weight: 600;
        color: #f1f5f9;
        font-variant-numeric: tabular-nums;
    }

    .close-btn {
        background: none;
        border: none;
        color: white;
        cursor: pointer;
        padding: 1rem;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .close-btn:hover {
        color: #ef4444;
        transform: scale(1.1);
    }

    .visualizer-main {
        flex: 1;
        display: flex;
        position: relative;
        width: 100vw;
        height: 100vh;
        align-items: center;
        justify-content: center;
    }

    .laser-layer {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 25; /* Entre la imagen y los botones de nav side */
        pointer-events: none; /* Por defecto desactivado */
    }

    .laser-layer.active {
        pointer-events: auto;
        cursor: crosshair;
    }

    .image-stage {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 0;
    }

    .image-stage img {
        width: 100%;
        height: 100%;
        object-fit: contain;
        max-width: 100vw;
        max-height: 100vh;
        filter: drop-shadow(0 20px 50px rgba(0, 0, 0, 0.5));
    }

    .side-nav-btn {
        position: absolute;
        top: 0;
        height: 100%;
        width: 15%;
        background: transparent;
        border: none;
        color: rgba(255, 255, 255, 0.1);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        z-index: 10;
    }

    .side-nav-btn:hover:not(:disabled) {
        background: linear-gradient(
            to right,
            rgba(255, 255, 255, 0.05),
            transparent
        );
        color: rgba(255, 255, 255, 0.8);
    }

    .side-nav-btn.next:hover:not(:disabled) {
        background: linear-gradient(
            to left,
            rgba(255, 255, 255, 0.05),
            transparent
        );
    }

    .side-nav-btn.prev {
        left: 0;
    }
    .side-nav-btn.next {
        right: 0;
    }

    .side-nav-btn:disabled {
        opacity: 0;
        cursor: default;
    }

    /* Ocultar scrollbar body al abrir */
    :global(body.visualizer-open) {
        overflow: hidden !important;
        height: 100vh;
    }
</style>
